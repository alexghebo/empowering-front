{"version":3,"sources":["../../../src/js/custom/create-post.js"],"names":["$","document","ready","userId","cookie","authToken","on","uploads","files","uploadPictures","ajax","type","url","baseUrl","contentType","headers","Authorization","crossDomain","success","data","submit","event","attachmentIds","children","each","push","attr","preventDefault","val","length","content","JSON","stringify","attachments","location","reload","alert","attachemntIds","i","jsonArray","FormData","append","name","console","log","getAll","key","entries","opts","cache","async","processData","method","fileNameCreatePost","substring","id","fake","xhr","jQuery","ajaxSettings","send","sendAsBinary","boundary","toString","response","html","addFacebookFeed","FB","api","dateFb","j","postari","message","createdAt","created_time","facebookID"],"mappings":"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","sourcesContent":["$(document).ready(function () {\n  var userId = $.cookie(\"authUserId\");\n  var authToken = $.cookie(\"authToken\");\n  $(\"#files\").on(\"change\", function () {\n    var uploads = $(\"#files\")[0].files;\n    uploadPictures();\n  });\n\n  $.ajax({\n    type: \"get\",\n    url: baseUrl + \"/api/posts/user/\" + userId,\n    contentType: \"application/json\",\n    headers: {\n      Authorization: \"Bearer \" + authToken,\n    },\n    crossDomain: true,\n    success: function (data) {},\n  });\n\n  $(\"form#create-post-form\").submit(function (event) {\n    var attachmentIds = [];\n    $(\"div#file-name\")\n      .children()\n      .each(function () {\n        attachmentIds.push($(this).attr(\"data-attachment-id\"));\n      });\n    event.preventDefault();\n    if (\n      !($(\"textarea#post-content\").val() === \"\" && attachmentIds.length === 0)\n    ) {\n      var content = $(\"textarea#post-content\").val();\n      $.ajax({\n        type: \"POST\",\n        url: baseUrl + \"/api/posts\",\n        contentType: \"application/json\",\n        headers: {\n          Authorization: \"Bearer \" + authToken,\n        },\n        crossDomain: true,\n        data: JSON.stringify({\n          userId: userId,\n          content: content,\n          attachments: attachmentIds,\n        }),\n        success: function () {\n          location.reload(true);\n        },\n      });\n    } else {\n      alert(\"Post content missing!\");\n    }\n  });\n});\n\nfunction uploadPictures() {\n  var attachemntIds = [];\n\n  var files = $(\"#files\")[0].files;\n\n  for (var i = 0; i < files.length; i++) {\n    let jsonArray = new FormData();\n    jsonArray.append(\"attachment\", files[i]);\n    jsonArray.append(\"title\", files[i].name);\n\n    console.log(jsonArray.getAll(\"attachment\"));\n    for (var key of jsonArray.entries()) {\n      console.log(key[0] + \", \" + key[1]);\n    }\n\n    var opts = {\n      url: baseUrl + \"/api/attachments\",\n      data: jsonArray,\n      cache: false,\n      async: false,\n      contentType: false,\n      processData: false,\n      method: \"POST\",\n      type: \"POST\", // For jQuery < 1.9\n      headers: { Authorization: \"Bearer \" + $.cookie(\"authToken\") },\n      success: function (data) {\n        var fileNameCreatePost = files[i].name;\n        if (fileNameCreatePost.length > 20) {\n          fileNameCreatePost = fileNameCreatePost.substring(0, 20) + \"[...]\";\n        }\n        $(\"div#file-name\").append(`\n        <div class=\"d-flex justify-content-between align-items-center mb-3 w-75\" data-attachment-id=\"${\n          data.id\n        }\">\n          <div class=\"d-flex align-items-center\">\n              <div><i class=\"cil-file\" style=\"font-size: 30px; padding-right:10px;\"></i></div>\n              <div>${fileNameCreatePost ? fileNameCreatePost : \"filename\"}</div>\n          </div>\n          <div id=\"delete-attachment\" class=\"p-2\" style=\"cursor: pointer\">\n              <i class=\"cil-x text-dark\"></i>\n          </div>\n      </div>\n      `);\n        attachemntIds.push(data.id);\n      },\n    };\n    if (jsonArray.fake) {\n      // Make sure no text encoding stuff is done by xhr\n      opts.xhr = function () {\n        var xhr = jQuery.ajaxSettings.xhr();\n        xhr.send = xhr.sendAsBinary;\n        return xhr;\n      };\n      opts.contentType = \"multipart/form-data; boundary=\" + jsonArray.boundary;\n      opts.data = jsonArray.toString();\n    }\n    let response = jQuery.ajax(opts);\n  }\n}\n$(document).on(\"click\", \"input.form-create-post\", function () {\n  $(\"textarea#post-content\").val(\"\");\n  $(\"div#file-name\").html(\"\");\n});\n\n// function addFacebookFeed() {\n//   var userId = $.cookie(\"authUserId\");\n//   var authToken = $.cookie(\"authToken\");\n//   FB.api(\"/me/feed\", function (response) {\n//     console.log(response);\n//     for (let i in response.data) {\n//       console.log(response.data[i].id);\n//       if (response.data[i].message && i <= 10) {\n//         $.ajax({\n//           type: \"POST\",\n//           url: baseUrl + \"/api/posts\",\n//           contentType: \"application/json\",\n//           headers: {\n//             Authorization: \"Bearer \" + authToken,\n//           },\n//           crossDomain: true,\n//           data: JSON.stringify({\n//             userId: userId,\n//             createdAt: response.data[i].created_time,\n//             facebookID: response.data[i].id,\n//             content: response.data[i].message,\n//             attachemntIds: \"\",\n//           }),\n//           success: function () {\n//             // location.reload(true);\n//           },\n//         });\n//       }\n//     }\n//   });\n// }\nfunction addFacebookFeed() {\n  var userId = $.cookie(\"authUserId\");\n  var authToken = $.cookie(\"authToken\");\n  FB.api(\"/me\", function (response) {\n    console.log(response.id);\n    FB.api(\"/\" + response.id + \"/accounts\", function (dateFb) {\n      console.log(dateFb.data.length);\n      if (dateFb.data.length > 0) {\n        for (let j in dateFb.data) {\n          console.log(\"intra pe pagina\");\n          FB.api(\"/\" + dateFb.data[j].id + \"/feed\", function (postari) {\n            console.log(postari);\n            for (let i in postari.data) {\n              // console.log(response.data[i], userId);\n\n              if (postari.data[i].message && i <= 10) {\n                console.log(postari.data[i], i);\n                $.ajax({\n                  type: \"POST\",\n                  url: baseUrl + \"/api/posts\",\n                  contentType: \"application/json\",\n                  headers: {\n                    Authorization: \"Bearer \" + authToken,\n                  },\n                  crossDomain: true,\n                  data: JSON.stringify({\n                    userId: userId,\n                    createdAt: postari.data[i].created_time,\n                    facebookID: postari.data[i].id,\n                    content: postari.data[i].message,\n                    attachemntIds: \"\",\n                  }),\n                  success: function () {\n                    // location.reload(true);\n                  },\n                });\n              }\n            }\n          });\n        }\n      } else {\n        console.log(\"intra pe feed\");\n        FB.api(\"/me/feed\", function (response) {\n          for (let i in response.data) {\n            // console.log(response.data[i], userId);\n\n            if (response.data[i].message && i <= 10) {\n              console.log(response.data[i], i);\n              $.ajax({\n                type: \"POST\",\n                url: baseUrl + \"/api/posts\",\n                contentType: \"application/json\",\n                headers: {\n                  Authorization: \"Bearer \" + authToken,\n                },\n                crossDomain: true,\n                data: JSON.stringify({\n                  userId: userId,\n                  createdAt: response.data[i].created_time,\n                  facebookID: response.data[i].id,\n                  content: response.data[i].message,\n                  attachemntIds: \"\",\n                }),\n                success: function () {\n                  // location.reload(true);\n                },\n              });\n            }\n          }\n        });\n      }\n    });\n  });\n}\n"],"file":"create-post.js"}